- id: graphql-phantom-token
  # Optional explicit version, otherwise Oathkeeper assumes current.
  version: v25.4.0
  match:
    # Match the original request host/path; Oathkeeper strips /decisions internally
    url: <http|https>://localhost:8080/graphql<.*>
    methods:
      - GET
      - POST
  # Upstream is unused by Decision API but harmless to keep for documentation.
  upstream:
    url: http://graphql-faker:9002
    preserve_host: true
  authenticators:
    # match the one defined in config.yaml
    - handler: oauth2_introspection
  authorizer:
    handler: allow
  mutators:
    - handler: id_token
      config:
        issuer_url: http://oathkeeper:4456/
        jwks_url: file:///etc/oathkeeper/jwks.json
        # Phantom access token audience your backend might check
        claims: >
          {
            "aud": ["graphql-backend"],
            "preferred_username": "{{ .Extra.preferred_username }}",
            "scope": "{{ .Extra.scope }}"
          }
